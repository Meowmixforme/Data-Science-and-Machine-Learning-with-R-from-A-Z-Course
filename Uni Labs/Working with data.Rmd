---
title: "Working with data"
output: html_notebook
---

# Data Preparation

Before you can visualise your data, you have to get it into R. This involves importing the data from an external source and converting it into a useful format.

## Importing data

R can import data from almost any source, including text files, excel spreadsheets, statistical packages, and database management systems. We'll  illustrate these techniques using the Salaries dataset, containing the 9-month academic salaries of college professors at a single institution in 2008-2009.

# Text files

The readr package provides functions for importing delimited text files into R data frames.

```{r}
library(readr)
```

# import data from a comma delimited file

```{r}
Salaries <- read.csv("salaries.csv")
```

# import data from a tab delimited file

```{r}
Salaries <- read.table("salaries.txt")
```

These functions assume that the first line of data contains the variable names, values and are separated by commas or tabs respectively, and that missing data are represented by blanks.

# Excel spreadsheets

The readxl package can import data from Excel workbooks. Both xls and xlsx formats are supported.

```{r}
library(readxl)
```

# import data from an Excel workbook

```{r}
Salaries <- read_excel("salaries.xlsx", sheet=1)
```

Since workbooks can have more than one worksheet, you can specify the one you want with the sheet option. The default is sheet=1.

# Statistical packages

The haven package provides functions for importing data from a variety of statistical packages.

```{r}
library(haven)
```

## Converting csv to dta

```{r}
library(haven)

x <- read.csv("salaries.csv")

# Replace illegal characters in variable names
names(x) <- gsub("\\.", "_", names(x))

# Write to Stata format
write_dta(x, "salaries.dta")
```

# import data from Stata

```{r}
Salaries <- read_dta("salaries.dta")
```

## Converting csv to SPSS

```{r}
write_sav(Salaries, "salaries.sav")
```

# import data from SPSS

```{r}
Salaries <- read_sav("salaries.sav")
```

# import data from SAS

```{r}
Salaries <- read_sas("salaries.sas7dbat")
```

# Selecting variables

The select function allows you to limit your dataset to specified variables (columns).

```{r}
library(dplyr)
```
# keep the variables name, height and gender

```{r}
newdata <- select(starwars, name, height, gender)
```

# keep the variables name and all variables between mass and species inclusive

```{r}
newdata <- select(starwars, name, mass:species)
```

# keep all variables except birth_year and gender

```{r}
newdata <- select(starwars, -birth_year, -gender)
```

# Selecting observations

The select function allows you to limit your dataset to observations (rows) meeting a specific criterion. Multiple criterea can be combined with the & (AND) and | (OR) symbols.

```{r}
library(dplyr)
```

# select females

```{r}
newdata <- filter(starwars,
                  gender == "feminine")
```

# select females that are from Alderaan

```{r}
newdata <- filter(starwars,
                  gender == "feminine" &
                    homeworld == "Alderaan")
```

# select individuals that are from Alderaan , Coruscant or Endor

```{r}
newdata <- filter(starwars,
                    homeworld == "Alderaan" |
                    homeworld == "Coruscant" |
                    homeworld == "Endor")
```

# this can be written more succinctly as

```{r}
newdata <- filter(starwars,
                    homeworld %in% c("Alderaan", "Coruscant", "Endor"))
```

# Creating/Recoding variables

The mutate function allows you to create new variables or transform existing ones.

```{r}
library(dplyr)
```

# convert height in centimeters to inches, and mass in kilograms to pounds

```{r}
newdata <- mutate(starwars,
                  height = height * 0.394,
                  mass = mass * 2.205)
```

The ifelse function (part of base R) can be used for recoding data. The format is ifelse(test, return of TRUE, return if FALSE).

```{r}
library(dplyr)
```

```{r}
newdata <- mutate(starwars,
                  heightcat = ifelse(height > 180,
                                     "tall",
                                     "short"))
```

# convert any eye colour that is not black, blue or brown, to other

```{r}
newdata <- mutate(starwars,
                  eye_color = ifelse(eye_color %in% c("black", "blue", "brown"),
                                     eye_color, "other"))
```

# set heights greater than 200 or less than 75 to missing

```{r}
newdata <- mutate(starwars, height = ifelse(height < 75 | height > 200, 
                                            NA,
                                            height))
```

# Summarizing data

The summarize function can be used to reduce multiple values down to a single value (such as mean). It is often used in conjunction with the by_group function, to calculate statistics by group. In the code below, the na.rm=TRUE option is used to drop missing values before calculating the means.

# calculate mean height and mass

```{r}
newdata <- summarise(starwars,
                     mean_ht = mean(height, na.rm=TRUE),
                     mean_mass = mean(mass, na.rm=TRUE))

newdata
```

